// ***************************** SHOULD ONLY BE UPDATED/CHANGED TROUGH OUR PROTOREPO **********************************
syntax = "proto3";

option csharp_namespace = "PartnerHub.Api.Protos";
import "google/protobuf/empty.proto";
import "google/protobuf/wrappers.proto";
import "google/type/money.proto";
import "google/protobuf/timestamp.proto";

service ReferralService {
  rpc CreateReferral (CreateReferralRequest) returns (ReferralDto);
  rpc CancelReferral(CancelReferralRequest) returns (ReferralDto);
  rpc SetReceiverCaseReferenceId(SetReceiverCaseReferenceIdRequest) returns (google.protobuf.Empty);
  rpc SetReceiverActorReferenceId(SetReceiverActorReferenceIdRequest) returns (google.protobuf.Empty);
  rpc SetAssignedTo(SetAssignedToRequest) returns (google.protobuf.Empty);
  rpc UpdateStatus(UpdateStatusRequest) returns (google.protobuf.Empty);

  rpc GetReferralDetails (GetReferralDetailsRequest) returns (ReferralDtoDetails);

  rpc GetReferralsForReferredActor (GetReferralsByReferredActorRequest) returns (ReferralList);

  rpc GetReferralsForProduct (GetReferralsByProductRequest) returns (ReferralList);
  rpc GetReferralsForRecipient (GetReferralsByRecipientRequest) returns (ReferralList);
  rpc GetReferralsForResourceGroup (GetReferralsByResourceGroupRequest) returns (ReferralList);
  rpc GetReferralsForAssignedActor (GetReferralsByAssignedActorRequest) returns (ReferralList);

  rpc GetReferralsForCaseReference (GetReferralsByCaseReferenceRequest) returns (ReferralList);

  rpc GetReferralsCreatedByActor (GetReferralsCreatedByActorRequest) returns (ReferralList);
  rpc GetReferralsCreatedFromResourceGroup (GetReferralsCreatedFromResourceGroupRequest) returns (ReferralList);

  rpc AddAttachment (AddAttachmentRequest) returns (AddAttachmentReply);
}

message ReferralDto{
  string id = 13;

  string product_package_id = 11;
  string product_id = 1;
  int32 product_version = 2;
  string product_type = 3;
  string product_channel_namespace = 10;
  string display_name = 6;
  string short_description = 7;
  ProductStatusDto custom_status = 37;
  google.type.Money price = 8;
  google.protobuf.StringValue price_unit_namespace = 23;
  google.protobuf.DoubleValue vat_rate = 21;

  google.protobuf.StringValue case_payload_reference_id = 5;
  google.protobuf.StringValue receiver_case_reference_id = 29;
  google.protobuf.StringValue receiver_actor_reference_id = 32;

  string status = 18;
  repeated InformationFieldDto information_fields = 17;

  OrderActorDto referred_actor = 4;
  OrderPartyDto receiver_resource_group = 9;
  OrderPartyDto receiver_order_party = 33;
  
  OrderPartyDto sender_order_resourceGroup = 34;
  OrderPartyDto sender_order_party = 35;
  
  OrderActorDto sent_by = 22;

  string created_by = 12;
  google.protobuf.Timestamp created_at_utc = 14;
  string updated_by = 15;
  google.protobuf.Timestamp updated_at_utc = 16;

  string referenceId = 19;
  bool amount_set_on_delivery = 20;

  bool allow_cancellation = 24;
  bool allow_comment = 25;
  bool show_status_to_sender = 26;
  bool show_case_state_to_sender = 27;

  google.protobuf.StringValue comment = 28;
  google.protobuf.StringValue receiver_internal_note = 30;
  google.protobuf.StringValue sender_internal_note = 31;

  repeated AttachmentDto attachments = 36;
}

message ReferralDtoDetails{
  ReferralDto referral = 1;
  google.protobuf.StringValue case_reference_payload = 3;

  OrderActorDto sent_by = 2;
  OrderActorDto assigned_to = 4;
  OrderActorDto referred_actor = 5;
  OrderActorDto updated_by = 8;
  OrderActorDto created_by = 13;

  OrderPartyDto receiver_resource_group = 9;
  OrderPartyDto receiver_order_party = 10;
  ReceiverCaseStatusDto receiver_case_reference_status = 14;

  OrderPartyDto sender_order_resourceGroup = 11;
  OrderPartyDto sender_order_party = 12;
  
}

message ReceiverCaseStatusDto{
  string case_reference_id = 1;
  string display_name = 2;
  string case_number = 3;
  string state_namespace = 4;
  string state_reason_namespace = 5;
  string state_flow_namespace = 6;
  string state_category_namespace = 7;
  repeated EndResultDto end_results = 8;
}

message EndResultDto{
  string end_result_namespace = 1;
  string end_result_outcome_namespace = 2;
}

message OrderActorDto{
  google.protobuf.StringValue id = 1; // optional. ex will be missing if an actor is referred from a bank into realequity. [Nicolaj]
  google.protobuf.StringValue realEquityActorId = 9;

  google.protobuf.StringValue display_name = 2;
  google.protobuf.StringValue first_name = 3;
  google.protobuf.StringValue last_name = 4;
  google.protobuf.StringValue email = 5;
  PhoneDto phone = 6;
  AddressDto address = 7;
}

message OrderPartyDto{
  string id = 1;
  string display_name = 2;
  string namespace = 3;
  repeated NamespaceValuePairDto externalIdentifiers = 4;
}

message NamespaceValuePairDto{
  string namespace = 1;
  string value = 2;
}

message PhoneDto{
  google.protobuf.StringValue number = 1;
  google.protobuf.StringValue country_code = 2;
}

message AddressDto{
  google.protobuf.StringValue display_name = 9;
  google.protobuf.StringValue street = 1;
  google.protobuf.StringValue street_number = 2;
  google.protobuf.StringValue floor = 4;
  google.protobuf.StringValue door = 5;
  google.protobuf.StringValue city = 6;
  google.protobuf.StringValue zip_code = 7;
  google.protobuf.StringValue country = 8;
}

message ReferralList{
  repeated ReferralDto referrals = 1;
}

message CreateReferralRequest{
  string product_id = 1;
  string product_package_id = 17;
  int32 product_version = 2;
  string product_type = 3;
  string product_channel_namespace = 26;
  string display_name = 4;
  string short_description = 5;
  repeated ProductStatusDto product_statuses = 28;
  google.type.Money price = 15;
  google.protobuf.StringValue price_unit_namespace = 16;
  google.protobuf.DoubleValue vat_rate = 23;

  string executing_actor_id = 6;
  OrderActorDto custom_executing_actor = 25;
  repeated string executing_actor_permissions = 14;

  OrderActorDto referred_actor = 7;

  string recipient_resource_group_id = 9;
  google.protobuf.StringValue recipient_order_party_id = 10;
  google.protobuf.StringValue receiver_internal_note = 30;

  string sent_by_resource_group = 11;
  google.protobuf.StringValue sender_order_party_id = 12;
  OrderActorDto sent_by = 8;
  google.protobuf.StringValue sender_internal_note = 29;

  repeated InformationFieldDto information_fields = 13;

  bool allow_cancellation = 18;
  bool allow_comment = 19;
  bool show_status_to_sender = 20;
  bool show_case_state_to_sender = 21;

  google.protobuf.StringValue comment = 22;
  google.protobuf.StringValue case_payload_reference_id = 27;
  bool amount_set_on_delivery = 24;
}

message SetReceiverCaseReferenceIdRequest{
  string referral_id = 1;
  string case_id = 6;

  string executing_actor_id = 2;
  OrderActorDto custom_executing_actor = 3;
  repeated string executing_actor_permissions = 4;

  repeated string resource_group_scopes = 5;
}

message SetReceiverActorReferenceIdRequest{
  string referral_id = 1;
  string actor_id = 6;

  string executing_actor_id = 2;
  OrderActorDto custom_executing_actor = 3;
  repeated string executing_actor_permissions = 4;

  repeated string resource_group_scopes = 5;
}

message SetAssignedToRequest{
  string referral_id = 1;
  OrderActorDto assigned_to = 2;

  string executing_actor_id = 3;
  OrderActorDto custom_executing_actor = 4;
  repeated string executing_actor_permissions = 5;

  repeated string resource_group_scopes = 6;
}

message InformationFieldDto{
  string identifier = 1;
  string type = 2;
  string value = 3;
  string name = 4;
}

message CancelReferralRequest{
  string id = 1;
  string executing_actor_id = 2;
  string executing_resource_group_id = 3;
  repeated string executing_actor_permissions = 4;
}

message GetReferralDetailsRequest{
  string id = 1;
  repeated string resource_group_scopes = 2;
}

message GetReferralsByProductRequest{
  string product_id = 1;
  google.protobuf.Int32Value product_version = 2;
  repeated string resource_group_scopes = 3;

  google.protobuf.Int32Value top = 4;
  google.protobuf.Int32Value skip = 5;
  repeated string status_filters = 6; 
}

message GetReferralsByReferredActorRequest{
  string referred_actor_id = 1;
  repeated string resource_group_scopes = 2;

  google.protobuf.Int32Value top = 4;
  google.protobuf.Int32Value skip = 5;
  repeated string status_filters = 6;
}

message GetReferralsByRecipientRequest{
  string order_recipient_id = 1;
  repeated string resource_group_scopes = 2;

  google.protobuf.Int32Value top = 4;
  google.protobuf.Int32Value skip = 5;
  repeated string status_filters = 6;
}

message GetReferralsByResourceGroupRequest{
  string resource_group_id = 1;

  google.protobuf.Int32Value top = 4;
  google.protobuf.Int32Value skip = 5;
  repeated string status_filters = 6;
}

message GetReferralsByAssignedActorRequest{
  string assigned_actor_id = 1;
  repeated string resource_group_scopes = 2;

  google.protobuf.Int32Value top = 4;
  google.protobuf.Int32Value skip = 5;
  repeated string status_filters = 6;
}

message GetReferralsCreatedByActorRequest{
  string actor_id = 1;
  repeated string resource_group_scopes = 2;

  google.protobuf.Int32Value top = 4;
  google.protobuf.Int32Value skip = 5;
  repeated string status_filters = 6;
}

message GetReferralsCreatedFromResourceGroupRequest{
  string resource_group_id = 1;

  google.protobuf.Int32Value top = 4;
  google.protobuf.Int32Value skip = 5;
  repeated string status_filters = 6;
}

message GetReferralsByCaseReferenceRequest{
  string case_reference_id = 1;
  repeated string resource_group_scopes = 2;

  google.protobuf.Int32Value top = 4;
  google.protobuf.Int32Value skip = 5;
  repeated string status_filters = 6;
}

message UpdateStatusRequest{
  string product_order_id = 1;
  google.protobuf.StringValue status = 2;
  google.protobuf.StringValue custom_status = 7;

  string executing_actor_id = 3;
  OrderActorDto custom_executing_actor = 4;
  repeated string executing_actor_permissions = 5;

  repeated string resource_group_scopes = 6;
}

  message AddAttachmentRequest {
  string product_order_id = 1;
  string attachmentIdentifier = 2;
  string filename = 3;
  string content_type = 4;
  bytes content = 5;

  string executing_actor_id = 6;
  OrderActorDto custom_executing_actor = 7;
  repeated string executing_actor_permissions = 8;
}

message AddAttachmentReply {
  AttachmentDto attachment = 1;
}

message AttachmentDto {
  string product_order_id = 1;
  string attachment_id = 2;
  string attachment_identifier = 3;
  string filename = 4;
}

message ProductStatusDto{
  string identifier = 1;
  string display_name = 2;
}